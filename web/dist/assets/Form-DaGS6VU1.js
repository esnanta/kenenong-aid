import{r as B,j as e,f as U,g as $,H as G,L as E,B as j,C as J,a as K,b as M,e as Q,d as W,t as u,i as X}from"./app-BLAu0s-k.js";import{u as Y,a as Z,o as ee,s as l}from"./schemas-BlBNX1Er.js";import{D as se}from"./DashboardLayout-lqqN-nb-.js";import{I as A}from"./input-DhAMWrKR.js";import{L as m}from"./label-7NtcvhHA.js";import{S as F,a as w,b as L,c as O,d as T}from"./select-DUzayBVp.js";import{A as te}from"./arrow-left-C9zs7EbO.js";import"./Logo-BJkCVtS2.js";import"./index-DfJ-yVqU.js";import"./index-Dpf8Yrbs.js";import"./index-CAGsf3C7.js";const I=B.forwardRef(({className:t,...n},p)=>e.jsx("textarea",{className:U("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-y",t),ref:p,...n}));I.displayName="Textarea";const re=ee({disaster_type:l().min(1,"Disaster type is required"),disaster_status:l().min(1,"Disaster status is required"),start_date:l().min(1,"Start date is required"),end_date:l().optional().nullable(),description:l().min(1,"Description is required").min(10,"Description must be at least 10 characters")});function fe({disaster:t,errors:n,disasterTypes:p,disasterStatuses:k}){var g,v;const{props:c}=$(),d=!!(t!=null&&t.id),{register:x,handleSubmit:q,formState:{errors:h,isSubmitting:_},watch:b,setValue:y}=Y({resolver:Z(re),defaultValues:{disaster_type:((g=t==null?void 0:t.disaster_type)==null?void 0:g.toString())||"",disaster_status:((v=t==null?void 0:t.disaster_status)==null?void 0:v.toString())||"",start_date:(t==null?void 0:t.start_date)||"",end_date:(t==null?void 0:t.end_date)||"",description:(t==null?void 0:t.description)||""}}),V=s=>{var S,C;const a=(S=document.querySelector('meta[name="csrf-token"]'))==null?void 0:S.getAttribute("content"),P=(C=document.querySelector('meta[name="csrf-param"]'))==null?void 0:C.getAttribute("content"),N=a||c.csrfToken,D=P||c.csrfParam;if(!N||!D){u.error("CSRF token missing. Please refresh the page.");return}const H={disaster_type:Number.parseInt(s.disaster_type),disaster_status:Number.parseInt(s.disaster_status),start_date:s.start_date,end_date:s.end_date||null,description:s.description,[D]:N},R=d?`/disasters/${t.id}/edit`:"/disasters/create";X[d?"put":"post"](R,H,{preserveScroll:!0,onSuccess:i=>{(i==null?void 0:i.component)==="Disasters/Index"&&u.success(d?"Disaster updated successfully":"Disaster created successfully")},onError:i=>{console.error("Form submission error:",i),i&&typeof i=="object"&&Object.values(i).forEach(o=>{Array.isArray(o)?o.forEach(z=>u.error(z)):typeof o=="string"&&u.error(o)})}})},r={},f=(c==null?void 0:c.errors)||{};return h&&Object.keys(h).forEach(s=>{const a=h[s];a!=null&&a.message&&(r[s]=a.message)}),n&&Object.keys(n).forEach(s=>{const a=n[s];r[s]=Array.isArray(a)?a[0]:a}),f&&Object.keys(f).forEach(s=>{const a=f[s];r[s]||(r[s]=Array.isArray(a)?a[0]:a)}),e.jsxs(e.Fragment,{children:[e.jsx(G,{title:d?"Edit Disaster":"Create Disaster"}),e.jsx(se,{user:c.user,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(E,{href:"/disasters",children:e.jsx(j,{variant:"ghost",size:"icon",children:e.jsx(te,{className:"h-4 w-4"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:d?"Edit Disaster":"Create Disaster"}),e.jsx("p",{className:"text-muted-foreground",children:d?"Update disaster information":"Add a new disaster to the system"})]})]}),e.jsxs(J,{children:[e.jsxs(K,{children:[e.jsx(M,{children:"Disaster Information"}),e.jsx(Q,{children:"Enter the disaster details below"})]}),e.jsx(W,{children:e.jsxs("form",{onSubmit:q(V),className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"disaster_type",children:"Disaster Type *"}),e.jsxs(F,{value:b("disaster_type"),onValueChange:s=>y("disaster_type",s),children:[e.jsx(w,{id:"disaster_type",className:r.disaster_type?"border-destructive":"",children:e.jsx(L,{placeholder:"Select disaster type"})}),e.jsx(O,{children:Object.entries(p||{}).map(([s,a])=>e.jsx(T,{value:s,children:a},s))})]}),r.disaster_type&&e.jsx("p",{className:"text-sm text-destructive",children:r.disaster_type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"disaster_status",children:"Status *"}),e.jsxs(F,{value:b("disaster_status"),onValueChange:s=>y("disaster_status",s),children:[e.jsx(w,{id:"disaster_status",className:r.disaster_status?"border-destructive":"",children:e.jsx(L,{placeholder:"Select status"})}),e.jsx(O,{children:Object.entries(k||{}).map(([s,a])=>e.jsx(T,{value:s,children:a},s))})]}),r.disaster_status&&e.jsx("p",{className:"text-sm text-destructive",children:r.disaster_status})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"start_date",children:"Start Date *"}),e.jsx(A,{id:"start_date",type:"date",...x("start_date"),className:r.start_date?"border-destructive":""}),r.start_date&&e.jsx("p",{className:"text-sm text-destructive",children:r.start_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"end_date",children:"End Date"}),e.jsx(A,{id:"end_date",type:"date",...x("end_date"),className:r.end_date?"border-destructive":""}),r.end_date&&e.jsx("p",{className:"text-sm text-destructive",children:r.end_date})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"description",children:"Description *"}),e.jsx(I,{id:"description",rows:5,placeholder:"Enter disaster description...",...x("description"),className:r.description?"border-destructive":""}),r.description&&e.jsx("p",{className:"text-sm text-destructive",children:r.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{type:"submit",disabled:_,children:_?"Saving...":d?"Update Disaster":"Create Disaster"}),e.jsx(E,{href:"/disasters",children:e.jsx(j,{type:"button",variant:"outline",children:"Cancel"})})]})]})})]})]})})]})}export{fe as default};
