import{g as L,j as s,H as O,L as S,B as x,C as q,a as D,b as I,e as T,d as H,t as m,i as V}from"./app-BLAu0s-k.js";import{D as g}from"./DashboardLayout-lqqN-nb-.js";import{I as j}from"./input-DhAMWrKR.js";import{L as p}from"./label-7NtcvhHA.js";import{u as B,a as R,o as _,s as b}from"./schemas-BlBNX1Er.js";import{A as z}from"./arrow-left-C9zs7EbO.js";import"./Logo-BJkCVtS2.js";import"./index-DfJ-yVqU.js";import"./index-Dpf8Yrbs.js";const $=_({name:b().min(1,"Name is required").min(2,"Name must be at least 2 characters"),email:b().min(1,"Email is required").email("Please enter a valid email address"),password:b().optional()});function ts({user:i,errors:d}){const{props:n}=L(),o=!!(i!=null&&i.id),{register:h,handleSubmit:A,formState:{errors:u,isSubmitting:y},watch:G,setValue:J}=B({resolver:R($),defaultValues:{name:(i==null?void 0:i.name)||"",email:(i==null?void 0:i.email)||"",password:""}}),k=a=>{var E,U;const r=(E=document.querySelector('meta[name="csrf-token"]'))==null?void 0:E.getAttribute("content"),F=(U=document.querySelector('meta[name="csrf-param"]'))==null?void 0:U.getAttribute("content"),v=r||n.csrfToken,w=F||n.csrfParam;if(!v||!w){m.error("CSRF token missing. Please refresh the page.");return}if(!o&&!a.password){m.error("Password is required");return}const N={...a,[w]:v};o&&!a.password&&delete N.password;const P=o?`/users/${i.id}/edit`:"/users/create";V[o?"put":"post"](P,N,{preserveScroll:!0,onSuccess:e=>{var l,C;const c=(e==null?void 0:e.component)==="Users/Index";e==null||e.component,(l=e==null?void 0:e.props)!=null&&l.errors&&Object.keys(e.props.errors).length>0||(C=e==null?void 0:e.props)!=null&&C.serverErrors&&Object.keys(e.props.serverErrors).length>0,c&&m.success(o?"User updated successfully":"User created successfully")},onError:e=>{console.error("Form submission error:",e),e&&typeof e=="object"&&Object.values(e).forEach(c=>{Array.isArray(c)?c.forEach(l=>m.error(l)):typeof c=="string"&&m.error(c)})}})},t={},f=(n==null?void 0:n.errors)||{};return u&&Object.keys(u).forEach(a=>{const r=u[a];r!=null&&r.message&&(t[a]=r.message)}),d&&Object.keys(d).forEach(a=>{const r=d[a];t[a]=Array.isArray(r)?r[0]:r}),f&&Object.keys(f).forEach(a=>{const r=f[a];t[a]||(t[a]=Array.isArray(r)?r[0]:r)}),s.jsxs(s.Fragment,{children:[s.jsx(O,{title:o?"Edit User":"Create User"}),s.jsx(g,{user:n.user,children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(S,{href:"/users",children:s.jsx(x,{variant:"ghost",size:"icon",children:s.jsx(z,{className:"h-4 w-4"})})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:o?"Edit User":"Create User"}),s.jsx("p",{className:"text-muted-foreground",children:o?"Update user information":"Add a new user to the system"})]})]}),s.jsxs(q,{children:[s.jsxs(D,{children:[s.jsx(I,{children:"User Information"}),s.jsx(T,{children:"Enter the user's details below"})]}),s.jsx(H,{children:s.jsxs("form",{onSubmit:A(k),className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(p,{htmlFor:"name",children:"Name *"}),s.jsx(j,{id:"name",type:"text",...h("name"),className:t.name?"border-destructive":""}),t.name&&s.jsx("p",{className:"text-sm text-destructive",children:t.name})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(p,{htmlFor:"email",children:"Email *"}),s.jsx(j,{id:"email",type:"email",...h("email"),className:t.email?"border-destructive":""}),t.email&&s.jsx("p",{className:"text-sm text-destructive",children:t.email})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(p,{htmlFor:"password",children:["Password ",o?"(leave blank to keep current password)":"*"]}),s.jsx(j,{id:"password",type:"password",...h("password"),className:t.password?"border-destructive":""}),t.password&&s.jsx("p",{className:"text-sm text-destructive",children:t.password})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(x,{type:"submit",disabled:y,children:y?"Saving...":o?"Update User":"Create User"}),s.jsx(S,{href:"/users",children:s.jsx(x,{type:"button",variant:"outline",children:"Cancel"})})]})]})})]})]})})]})}export{ts as default};
